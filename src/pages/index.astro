---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Hero from '../components/Hero.astro';
import Description from '../components/Description.astro';
import SearchResults from '../components/SearchResults.astro';
import { registries, defaultRegistry } from '../config/registries';

// Parse domain from URL query
function parseDomainFromUrl(fullDomain: string) {
	if (!fullDomain) return null;
	
	const trimmed = fullDomain.trim().toLowerCase();
	
	// Check if domain has any valid extension
	for (const registry of registries) {
		if (trimmed.endsWith(registry.extension)) {
			const domainWithoutExt = trimmed.slice(0, -registry.extension.length);
			return {
				domain: domainWithoutExt,
				extension: registry.extension
			};
		}
	}
	
	// No extension found, use default
	return {
		domain: trimmed,
		extension: defaultRegistry.extension
	};
}

// Check if there's a domain search query
const domainParam = Astro.url.searchParams.get('domain');
const parsed = domainParam ? parseDomainFromUrl(domainParam) : null;
const showResults = parsed && parsed.domain.length > 0;
---

<Layout>
	<Header />
	<Hero registries={registries} defaultRegistry={defaultRegistry} />
	
	{showResults && parsed ? (
		<SearchResults domain={parsed.domain} extension={parsed.extension} />
	) : (
		<>
			<Description />
		</>
	)}
</Layout>
