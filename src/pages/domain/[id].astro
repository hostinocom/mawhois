---
export const prerender = false; // this page becomes SSR

import Layout from '../../layouts/Layout.astro';
import DomainAvailable from '../../components/sections/domain/DomainAvailable.astro';
import DomainUnavailable from '../../components/sections/domain/DomainUnavailable.astro';

// Get domain from URL params
const domain = Astro.params.id;

// Fetch WHOIS data server-side
let result = null;

if (domain) {
	const apiUrl = import.meta.env.PUBLIC_API_URL || 'http://localhost:4321';
	try {
		const response = await fetch(`${apiUrl}/api/whois?domain=${encodeURIComponent(domain)}`);
		result = await response.json();
		console.log("WHOIS data:", result);
	} catch (error) {
		console.error('Error fetching domain:', error);
	}
}

// Redirect to home if no domain parameter
if (!domain) {
	return Astro.redirect('/');
}
---

<Layout>
	
	{result?.available ? (
		<DomainAvailable domain={domain} />
	) : (
		<DomainUnavailable domain={domain} info={result?.info} />
	)}
	
</Layout>
